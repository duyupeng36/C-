# 网路

对于同⼀台设备上的进程间通信，有很多种⽅式，⽐如有管道、消息队列、共享内存、信号等⽅式，⽽对于不同设备上的进程间通信，就需要 **⽹络** 通信，⽽设备是多样性的，所以要兼容多种多样的设备，就协商出了⼀套通⽤的 **⽹络协议**

> [!tip]
> 
> 网络的出现是为了提供给两个运行在不同计算机上的进程进行通信的
> 

## 互联网

**互联网**，会将不同的计算机网络连接起来并允许位于网络中的主机相互之间进行通信

> [!tip]
>互联网即 **网络的网络**，其中的一个网络称为 **子网**

下图就是一个简单的互联网

![[Pasted image 20241113221403.png]]


机器 `tekapo` 是一种 **路由器**，它一台 **将一个子网络连接到另一个子网络** 并在它们之间传输数据的计算机

为了使互联之间进行通信，设计出了多种互联网 **互联协议**。其中， **TCP/IP** 是使用为最广泛的 **协议套件** 

## 网络通信分层模型

### TCP/IP 模型

一个**联网协议**是 **定义如何在一个网络上传输信息的一组规则**。**联网协议** 通常会 **被组织成一系列的层**

> [!tip]
> 
> 每一层都构建于下层之上并提供特性以供上层使用
> 

**TCP/IP 协议套件** 是一个 **分层联网协议**。如下图

![[Pasted image 20241113221821.png]]

**TCP/IP** 包括 **因特网协议(IP)** 和位于 **其上层的各个协议层**。（实现这些层的代码通常被称为协议栈。）名字 TCP/IP 是从 **_传输控制协议(TCP)_** 是使用最为广泛的传输层协议这样一个事实而得出来的

协议分层如此强大和灵活的其中一个原因是透明：**每一个协议层都对上层隐藏下层的操作和复杂性**

> [!example] 每个协议层对其上层隐藏实现细节
> 
> 如一个使用 TCP 的应用程序只需要使用标准的 socket API 并清楚自己正在使用一项可靠的字节流传输服务，而无需理解 TCP 操作的细节。应用程序也无需知道 IP 和数据链路层的操作细节
> 

### ISO/OSI 模型

**ISO/OSI 模型**（开放系统互联参考模型，Open Systems Interconnection Reference Model）是一种 **分层网络架构模型**，用于帮助理解不同网络协议和技术如何协同工作，确保跨平台和跨技术的互操作性

该模型 **将网络通信过程分为七个层次**，每一层负责不同的任务，从物理传输到应用服务。下图对比了 ISO/OSI 模型和 TCP/IP 模型

![[Pasted image 20241113230034.png]]

### 封装与解包

**封装** 是分层联网协议中的一个重要的原则，每个协议层都 **将上层数据包装为它能识别的数据**。下图给出了 TCP/IP 协议层中的封装

![[Pasted image 20241113222203.png]]

> [!tip] 封装：将上层协议的数据使用一个 **头** 封装为当前层可以识别的数据
> 
> 每一层都会在上层传递过来的数据前面附加上一个可以识别当前层的头
> 

> [!tip]
> 封装中的关键概念是 **低层会将从高层向低层传递的信息（如应用程序数据、TCP 段、IP 数据报）当成不透明的数据来处理**

换句话说，**低层不会尝试对高层发送过来的信息进行解释**，而只会将这些信息放到低层所使用的包中并在将这个包向下传递到低层之前 **添加自身这一层的头信息**

> [!hint] 
> 
>当数据从低层传递到高层时将会进行一个逆向的 **解包** 过程。如下图所示
>
> ![[Pasted image 20241113231025.png]]
>

后续我们将按照 TCP/IP 模型学习

## 协议

在没有约定数据如何解析之前，单纯的将数据从发送方拷贝到接收方是没有用处的

计算机之间的通信是通过 **字节序列** 进行传输，如果没有提前约定字节序列的解析方式，接收方可能按照任意方式解析它收到的数据。因此，在通信前需要提前约定字节序列的解析方式，从而确保接收双方看到的数据是一样的

这种发送方和接收方 **提前约定好的数据解析方式** 称为 **协议**

> [!tip] 协议：通信双方提前约定好的数据解析方式

### 网络数据流

下图展示了通过 TCP/IP 协议进行的分层 **逻辑通信** 和 **数据流动**

![[Pasted image 20241114003826.png]]

主机 $A$ 将应用层数据传递给传输层(TCP/UDP协议)，并在应用层数据的头部附加上 **TCP/UDP 头**。然后，传输层协数据传递给网络层(IP以恶)，并在传输层数据头部附加上 **IP 头**。最后，网络层数据传递给数据链路层，并在网络层数据头部附加上 **MAC 头**和尾部附加上 **FCS**

主机 $B$ 在数据链路层收到主机 $A$ 传递过来的数据，去除数据链路层识别的附加信息并将剩余信息传递给网络层。然后，网络层并去除识别的附加信息并传递给传输层。最后，传输层去除识别的附加信息并传递给应用层

通过上面描述，我们发送两个主机之间 **相同层次的数据是一样的**。当我们考虑主机 $A$ 和主机 $B$ 之间的通信时，我们只考虑同等层次的协议即可

> [!tip] 
> 
> 每个层次只需要考虑自己应该实现的，而不需要关心下层实现。也就是说，后续介绍的 **协议都只属于它所在的层次**
> 

### 常见协议

常见协议的公开协议可以在 [RFC-editor](https://www.rfc-editor.org/) 查看。下表列出 TCP/IP 模型中涉及的各层协议

| 层次    | 协议                            |
| :---- | ----------------------------- |
| 应用层   | **https 协议**，ftp 协议，ssh 协议    |
| 传输层   | **TCP 协议**，**UDP 协议**，SCTP 协议 |
| 网络层   | **IP 协议**，ICMP 协议，IGMP 协议     |
| 数据链路层 | **ARP 协议**                    |

表中加粗的协议后续我们会重点介绍

### 地址




## 数据链路层协议














