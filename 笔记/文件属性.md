# 文件属性

## 获取文件属性：`stat()`

系统调用 `stat()` `lstat()` 和 `fstat()` 可获取与文件有关的信息，其中大部分信息都是来自文件的 $\text{i-node}$

```c
#include <sys/stat.h>

int stat(const char *pathname, struct stat *statbuf);

int lstat(const char *pathname, struct stat *statbuf);

int fstat(int fd, struct stat *statbuf);
/* 成功返回 0；失败返回 -1 */
```

上述三个系统调用都是获取文件元数据信息，只是对文件的描述方式不同

| 系统调用      | 描述                             |
| :-------- | :----------------------------- |
| `stat()`  | 获取 `pathname` 指定的文件元数据         |
| `lstat()` | 如果 `pathname` 是链接文件，则获取链接本身的信息 |
| `fstat()` | 获取打开文件描述符指代文件的元数据              |

所有系统调用都会在缓冲区中返回一个由 `statbuf` 指向的 `stat` 结构，其格式如下

```c
struct stat {
	dev_t st_dev; // 设备 ID 号
	ino_t st_ino; // i-node 号
	mode_t st_mode;  // 文件类型和权限
	nlink_t st_nlink; // 硬链接数
	uid_t st_uid; // 属主 ID
	gid_t st_gid; // 属组 ID
	dev_t st_rdev;  // 特殊设备 ID
	off_t st_size;  // 总字节数
	blksize_t st_blksize; // io块字节数
	blkcnt_t st_blocks;  // 存储块数
	time_t st_atime; // 最后访问时间
	time_t st_mtime; // 最后修改时间
	time_t st_ctime; // 最后状态改变时间
};
```

`st_dev` 字段标识文件所驻留的设备。`st_ino` 字段则包含了文件的 $\text{i-node}$ 号。利用 设备号和 $\text{i-node}$ 号可以唯一标识一个文件

> [!tip] 
> 
> `dev_t` 类型记录了设备的主 辅 ID
> 

如果是针对设备的 $\text{i-node}$，那么 `st_rdev` 字段则包含设备的主ID 和 辅 ID



 